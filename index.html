<?php
include '../function.php';
session_start();

if (isset($_GET['action'])) {
    //echo "J'ai reçu le formulaire ";
  
        $getAllInput = ['name','fristname','agerange','weight','temperature','gender','cough','diarrhea','weightloss','headache' ];

        $radioFields = [ 'headache', 'cough', 'diarrhea', 'weightloss'];
        $_SESSION['errors'] = false;
        
        //catch empty input 
        
     /*   foreach($getAllInput as $empty){  
            $empty = filter_var($_GET[$empty], FILTER_SANITIZE_STRING, FILTER_FLAG_STRIP_HIGH);
            if(empty($_GET[$empty]) ){   
                      
                $_SESSION['errors'] = true;
                //echo "des vides 1"; die();
                header('Location: ' .$_SERVER['HTTP_REFERER']);
            }else{
                $_SESSION[$empty] = $_GET[$empty]; 
            }

            if( isSafeInputs($_GET[$empty])){
                //echo $_GET[$empty];
                //echo "caractère innatendu"; die();
                header('Location: ' .$_SERVER['HTTP_REFERER']);
            }      

            if(empty(trim( ($_GET[$empty]) ) )){
                $_SESSION["space"] = "space";
                $_SESSION['errors'] = false;     
                //unset($_SESSION[$empty]);
                echo "have space or je fous quoi lq";
                die();
                header('Location: ' .$_SERVER['HTTP_REFERER']);

                
            }
          

        }
        

        if( strlen($_GET['name'] ==1 || strlen($_GET['name'] >=15 ) )){
            $_SESSION['errors'] = true;
            $_SESSION['sizeNameError'] = true;
            echo "The longer of you name is too long";
        }elseif( strlen($_GET['fristname'] ==1 || strlen($_GET['fristname'] >=15 ) )){
            $_SESSION['errors'] = true;
            $_SESSION['sizeNameError'] = true;
        }

        //CHECK name




     /*   foreach($radioFields as $empty){
            unset($_SESSION[$empty]);
            if(empty($_GET[$empty]) ){              
                $_SESSION['emptyInput']= $_GET[$empty];
                $_SESSION['errors'] = true;
                echo "des radio vides 1"; die();
                header('Location: ' .$_SERVER['HTTP_REFERER']);
            }else{
                $_SESSION[$empty] = $_GET[$empty]; 
            }
        }*/

        //catch space in all input 
       /* foreach($getAllInput as $empty){
            unset($_SESSION['space']);
            if(empty(trim( ($_GET[$empty]) ) )){
                $_SESSION["space"] = "space";
                $_SESSION['errors'] = true;     
                //unset($_SESSION[$empty]);
                echo "have space or je fous quoi lq";
                die();
                header('Location: ' .$_SERVER['HTTP_REFERER']);

                
            }
        }*/
        
        
        //unset($_SESSION['isEmpty']);
        if($_SESSION['errors'] == true){
            echo "ya des erreurs";
            
            echo " "; die();
            header('Location: ' .$_SERVER['HTTP_REFERER']);
            
        }
        else {  
            //le form nest pas vide 
            //echo "ya pas derreur"; die();
            //test perso   
            
            if(!is_numeric($_GET['weight']) && !is_numeric($_GET['temperature'])  ){
                $_SESSION['error'] = true;
                echo "dd ".is_numeric($_GET['temperature']);
                die();
                header('Location: ' .$_SERVER['HTTP_REFERER']);
            }else{
                echo "im in is numeric die"; 
          
            }

            if( $_GET['weight'] >=0 || $_GET['weight'] <=250 ){
                $_SESSION['error'] = true;
                $_SESSION['error_weight'] = true;
                header('Location: ' .$_SERVER['HTTP_REFERER']);
            }

            if ($_GET['temperature'] < 32 || $_GET['temperature'] > 43) {
                $_SESSION['error'] = true;
                $_SESSION['error_temperature'] = true;
                header('Location: ' . $_SERVER['HTTP_REFERER']);
            }

            if ( ($_GET['weight'] >= 0 && $_GET['weight'] <= 150) && ($_GET['temperature'] >= 32 && $_GET['temperature'] <= 43)){
                $_SESSION['percentage'] = 0;
            }
            


            //affectation
            foreach($getAllInput as $giviIt){
                $_SESSION[$giviIt] = $_GET[$giviIt];
            }
/*
            $_SESSION['name'] = $_GET['name'];
            $_SESSION['fristname'] = $_GET['fristname'];
            $_SESSION['weight'] = $_GET['weight'];
            $_SESSION['temperature'] = $_GET['temperature'];
            $_SESSION['gender'] = $_GET['gender'];
            $_SESSION['agerange'] = $_GET['agerange'];
            $_SESSION['headache'] = $_GET['headache'];
            $_SESSION['cough'] = $_GET['cough'];
            $_SESSION['diarrhea'] = $_GET['diarrhea'];
            $_SESSION['weightloss'] = $_GET['weightloss'];
*/

    
           
            //controle personalisé
  

            foreach ($radioFields as $field) {
                if (isset($_GET[$field]) === 'oui') {
                    $_SESSION['percentage'] += 10;
                } else {
                    $_SESSION['percentage'] = 0;
                }
            }

            if ($_GET['temperature'] >= 32 || $_GET['temperature'] <= 36) {
                $_SESSION['percentage'] += 10;
            }else {
                $_SESSION['percentage'] += 30;
            }

            if ($_GET['weight'] > 50 ){
                $_SESSION['percentage'] += 30;
            }

            if ($_GET['agerange'] == "child" ) {
                $_SESSION['percentage'] += 10;
            }
            elseif ($_GET['agerange'] == "teenager"){
                $_SESSION['percentage'] += 30;
            }
            elseif ($_GET['agerange'] == "adult"){
                $_SESSION['percentage'] += 50;
            }
            elseif ($_GET['agerange'] == "old"){
                $_SESSION['percentage'] += 60;
            }


            echo $_SESSION['percentage'];
           
            header('location: ' . $_SERVER['HTTP_REFERER']);
        }

        
       // Vérification n2

    }

?>
